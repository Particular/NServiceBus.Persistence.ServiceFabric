name: Local
on:
  pull_request:
  workflow_dispatch:
env:
  DOTNET_NOLOGO: true
jobs:
  build:
    name: ${{ matrix.name }}
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        include:
          - os: windows-2019
            name: Windows
          #- os: ubuntu-20.04
          #  name: Linux
      fail-fast: false
    steps:
      #- name: Set up 5-node cluster
      #  shell: pwsh
      #  run: "%PROGRAMFILES%\Microsoft SDKs\Service Fabric\Tools\ServiceFabricLocalClusterManager\ServiceFabricLocalClusterManager.exe" -waitformutex -SetupFiveNodeCluster
      - name: Set up 5-node cluster
        shell: powershell
        run: |
          # Import the cluster setup utility module
          $scriptsPath = (Get-ItemProperty 'HKLM:\Software\Microsoft\Service Fabric SDK').FabricSDKScriptsPath
          echo "Service Fabric SDK Install Path: $scriptsPath"
          
          Get-ChildItem $sdkInstallPath
          
          $modulePath = Join-Path -Path $scriptsPath -ChildPath "DefaultLocalClusterSetup.psm1"
          echo "Service Fabric Scripting Module Path: $modulePath"
          Import-Module $modulePath
          
          $result = Set-LocalClusterReady -createOneNodeCluster $False -createMeshCluster $False -isSecure $False
          echo $result
          
          exit 0
      - name: Dump Env
        shell: pwsh
        if: ${{ always() }}
        run: |
          gci env:
